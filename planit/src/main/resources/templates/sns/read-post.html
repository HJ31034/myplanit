<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="sns/layout/basic">
<th:block layout:fragment="title">
	<title>read post page</title>
</th:block>

<span layout:fragment="write-post">
	<div class="post_inner" th:object="${post}">

		<div class="post_box_left"> 
		
			<div class="photo_box">
	            <div class="swiper-wrapper">
	               <div class="swiper-slide" th:each="fileName, index : ${post.realFileNameArr}">
	                  <img class="photo swiper-lazy"  th:src="${'/imgs/img_section/' + fileName}" />
	               </div>
	            </div>
	            <div class="swiper-button-next"></div>
	            <div class="swiper-button-prev"></div>
	            <div class="swiper-pagination"></div>
         	</div>
         
			<div class="hashtag_box">
				<span th:text="'#' + *{plantsName}"></span><br/>
				<span th:text="'#' + *{weather}"></span><br/>
				<span th:text="'#' + *{address}"></span><br/>
				<span th:text="'#' + *{createDt}"></span>
			</div>
		</div>

		<div class="post_box_right_read">
			<div class="profile_box">
				<span class="profile_box_img">
					<img th:src="${'/imgs/img_section/' + accountProfile.profileImg}"/>					
				</span>
				<span>
					<a href="#" th:text="${post.userId}"></a>
					<a href="#" th:text="${accountProfile.accDescription}"></a>
				</span>
				<span>
					<a href="th:href="@{/planiter/post/modify}"">수정</a>
					<a href="th:href="@{/planiter/post/delete}"">삭제</a>
				</span>
			</div>
			<div class="read_box">
				<p th:text="*{postContent}">글읽기</p>
			</div>
			<div id="icon_box" class="icon_box" th:object="${isLike}">
				<span th:if="${isLike == 'unlike'}">
					<img src="/imgs/img_section/unlike.png" onclick= "return getLikeInfo('like')">
				</span>
				<span th:if="${isLike == 'like'}">
					<img src="/imgs/img_section/like.png" onclick= "return getLikeInfo('unlike')">
				</span>
				
				<img src="/imgs/img_section/comment.png">
			</div>
			
			<div class="comment_box">
				<div class="write_comment">
					<input id="user_id" type="hidden" th:object="${post}" th:field="${post.userId}">
					<input id="post_no" type="hidden" th:object="${post}" th:field="${post.postNo}">
					<textarea id="comment" placeholder="댓글 작성하기"></textarea>
				</div>
				<div class="commit_comment">
					<form>
						<button type="submit" class="getComment" onclick="return getComment()">등록</button>
					</form>
				</div>
			</div>
			<div class="comment">
				<table id="comment_table">
					<tr th:each="c,index : ${commentList}" th:if="${index.index} < 4">
						<th:block>
							<td th:text="${c.userId}"></td>
							<td th:text="${c.content}"></td>
							<td th:text="${c.regDate}"></td>
							<td href="#">삭제</td>
						</th:block>
					</tr>
				</table>
			</div>
		</div>
	</div>
</th:block>

<th:block layout:fragment="script">
	<script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
	
	<script th:inline="javascript">
		function getComment(){
			let userId = document.getElementById('user_id');
			let postNo = document.getElementById('post_no');
			let comment = document.getElementById('comment');
			
			let data = {
				'userId': userId.value,
				'postNo': postNo.value,
				'content': comment.value
			};
			
			comment.value = '';
			
			$.ajax({
				url : "/planiter/post/insert/comment",
				type : "post",
				data: data,
				success : function(data) {			
					$("#comment_table").replaceWith(data);
				},
				error : function(XHR, status, errosr) {
					console.error(status + " : " + error);
				}
			});
		 	
		 	return false;
		}
		
		function getLikeInfo(isLike){
			let userId = document.getElementById('user_id');
			let postNo = document.getElementById('post_no');
			
			let data = {
				'targetId': userId.value,
				'postNo': postNo.value,
				'isLike': isLike
			};
			
			$.ajax({
				url : "/planiter/post/like",
				type : "post",
				data: data,
				success : function(data) {
					
					$("#icon_box").replaceWith(data);	
						
				},
				error : function(XHR, status, errosr) {
					console.error(status + " : " + error);
				}
			});
		 	
		 	return false;
		}
		
		let swiper = new Swiper(".photo_box", {
	         slidesPerView: '1',
	         pagination: {
			    el: '.swiper-pagination',
			    type: 'bullets',
			    clickable: true,
			  },
	
	         // 좌우 화살표 navigation element 지정
	         navigation: {
	            nextEl: ".swiper-button-next",
	            prevEl: ".swiper-button-prev"
	         },
	      });

	</script>

</th:block>

</html>