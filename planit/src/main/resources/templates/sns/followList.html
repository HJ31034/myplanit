<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="sns/layout/basic">
<th:block layout:fragment="title">
		<title>PLANiT</title>
	</th:block>
 
  
<th:block layout:fragment="content">

 
        <div class="inner">

		<div class="contents_box">
			<article class="followContents">

				<!--팔로워 리스트 -->
				<div class="follower_section" id="follower_section"></div>

				<!-- 팔로잉 리스트  -->
			 
				<div class="following_section" id="following_section"></div>
			 	 
			</article>

		</div>

		<input type="hidden" id="page" value="1">
             

           <div class="side_box" th:each="info:${AccInfo}">
                <div class="user_profile">
                    <div class="profile_thumb">
                        <img th:src="@{${'/imgs/img_section/'+info.profileImg}}" alt="프로필사진"> 
                    </div>
                 </div>
                 <div> 
                  <div class="follower"  th:onclick="followerList(1)">
                  팔로워<br>  <p th:text="${info.followerCount}"/></div>
                  <div class="following"  th:onclick="followingList(1)">
                  팔로잉<br>  <p th:text="${info.followingCount}"/></div>
                   
                </div>
					<br><br>
					<!-- ##### Single Widget Area ##### -->
                        <div class="single-widget-area">
                            <!-- Title -->
                            <div class="widget-title">
                                <h1 style="text-align: center; width: 97%;">My Plants</h1>
                            </div>
                            <!-- Tags -->
                             
                            <ol th:each="cate:${CateList}" class="popular-tags d-flex flex-wrap" id="cateList">
                               <ol style="margin-left: -40px;">
                               		 <li>#<a th:text="${cate.plantsName}" href="#"></a> </li>
                               </ol>
                            </ol>
                            
                        </div>
			 	 
		</div>


        </div>
    
 </th:block>


<th:block layout:fragment="script">
 
 <script th:inline="javascript">
  
	 /*<![CDATA[*/
	 var fol = /*[[ ${fol} ]]*/ 
	 /*]]*/
		// 5.
	 console.log('fol: '+fol);
	 
	 var page = $("#page").val(); 
		  
	 if(fol==1){
		 followerList(page);
	 }else if(fol==2){
		 followingList(page);
	 }
     
  
	 $(function(){   
		 
		    if(fol==1){
			     followerList(page);
				 page++; 				
				}else if(fol==2){
			     followingList(page);
				 page++;
				}
		  }); 
		  
	 
	 
 $(".following_section").scroll(function() { 
 
		var innerHeight = $(this).innerHeight(); 
		var scroll=$(this).scrollTop() + $(this).innerHeight(); 
		var height=$(this)[0].scrollHeight; 

		
		if(scroll == height){  
			if(fol==1){
			 followerList(page);
			 page++; 				
			}else if(fol==2){
			 followingList(page);
			 page++;
			}
			 console.log('scroll == height page: '+page);
		} 
	});
 
 	  
 	   
 	 function followingList(page){ //팔로잉 리스트
 		 
 		 $(".following_section").empty();
 		 $(".following_section").show();
 		 $(".follower_section").hide();
 		 
 		 console.log('followingList 메소드 내부 page: '+page);
 		 
 		 $.ajax({
 				type : 'get',
 				url : "/planiter/followingList.do?page="+page,
 				contentType : "application/json; charset=UTF-8",
 				dataType : "json",
 				success : function(data) {
 					console.log(data);
 					 var followingList = "";
 					 
 					 if (page==1){   
 						    $(".following_section").html(""); 
 					  }  
 						 
 					  $.each(data, function(index, item) { // 데이터 =item
 						  followingList = '<div class="followList" id="followList">'
 							     +   '<div class="followIMGA">'
 							     +   '<img class="followIMG" src="/imgs/img_section/'+item.profileImg+'"alt="프로필사진">'
 				              	 +   '</div>'
 				              	 +   '<div class="followLIstInfo">'
 				            	 +   '<P   class="followUserName" >'+item.followingId+'</P>'
 				            	 +   '<P   class="followDis">'+item.accDescription+'</P>'
 				            	 +   '</div>'
 				            	 +	 '<div class="followButtonA">'
 				            	 +	 '<input onclick="followBTN(\''+item.followerId+'\',\''+item.followingId+'\',\''+item.ftype+'\',2)" id="followButton_'+item.followerId+item.followingId+'" class="followButton" type="button" value="'+ GetType(item.followerId,item.userId,item.followingId,item.ftype)+'"  />'
 				            	 +   '</div>'
 				            	 +   '</div>';
 				            	 
 				             $(".following_section").append(followingList);
 				             
 				             
 				             var btnID = "#followButton_" + item.followerId+item.followingId ;
 				             var btnID = "#followButton_" + item.followerId+item.followingId ;
 				             
 				             if (item.ftype == 1) { 
 				 				$(btnID).css("backgroundColor", "white");
 				 			} else {
 				 				 $(btnID).css("backgroundColor", "#9FCF62");
 				 				 $(btnID).css("color", "white");
 				 			}
 					});   
 					 
 				},
 				error : function(jqXHR, textStatus, errorThrown) {
 					console.log(jqXHR.responseText);
 				}
 			});
 		 

 	 }
 	  
 	  
		  
		 
		  /* 팔로워 리스트 */	
		  function followerList(page){
			  console.log('follower 메소드 내부 page: '+page);
		  	$(".follower_section").show();
		  	 $(".following_section").hide();
		  	 $(".follower_section").empty();
		  	 
		  		$.ajax({
		  			type : 'get',
		  			url : "/planiter/followerList.do",
		  			contentType : "application/json; charset=UTF-8",
		  			dataType : "json",
		  			success : function(data) {
		  				console.log(data);
		  				 var followerList = "";
		  				  $.each(data, function(index, item) { // 데이터 =item
		  					  
		  					  followerList = '<div class="followList" id="followList">'
		  						     +   '<div class="followIMGA">'
		  						     +   '<img class="followIMG" src="/imgs/img_section/'+item.profileImg+'"alt="프로필사진">'
		  			              	 +   '</div>'
		  			              	 +   '<div class="followLIstInfo">'
		  			            	 +   '<P   class="followUserName" >'+item.followingId+'</P>'
		  			            	 +   '<P   class="followDis">'+item.accDescription+'</P>'
		  			            	 +   '</div>'
		  			            	 +	 '<div class="followButtonA">'
		  			            	 +	 '<input onclick="followBTN( \''+item.followerId+'\',\''+item.followingId+'\',\''+item.ftype+'\',1)" id="followButton_'+item.followerId+item.followingId+'" class="followButton" type="button" value="'+ GetType(item.followerId,item.userId,item.followingId,item.ftype)+'"  />'
		  			            	 +   '</div>'
		  			            	 +   '</div>';
		  	
		  			             $(".follower_section").append(followerList);
		  			             
		  			             var btnID = "#followButton_" +item.followerId+item.followingId ;
		  			             if (item.ftype == 1) { 
		  			 				$(btnID).css("backgroundColor", "white");
		  			 			} else {
		  			 				 $(btnID).css("backgroundColor", "#9FCF62");
		  			 				 $(btnID).css("color", "white");
		  			 			}
		  			 				
		  			             
		  				});  
		  			},
		  			error : function(jqXHR, textStatus, errorThrown) {
		  				console.log(jqXHR.responseText);
		  			}
		  		});
		  	 
		  }		
		  		
		   
		   	function GetType(followID, userId, followingID, ftype) {//팔로잉인지 팔로워인지 확인
		  			var btnID = "#followButton_" + followID + followingID;
		  			console.log('Ftype ' + ftype);
		  			if (ftype == 1) {
		  			  	 console.log('btnID 1111: ' + btnID);
		  				 $(btnID).css("backgroundColor", "white");
		  				return "팔로잉";
		  			} else {
		  				console.log('btnID 0000: ' + btnID);
		  				 
		  				return "팔로우";
		  			}
		  			
		  			
		  		}
	 
		
		
		function followBTN(followerID,followingID, ftype, fol) {//팔로우 언팔로우 처리
			console.log('followBTN = ' + ftype);
			var btnID = "#followButton_" + followerID + followingID;
			
			console.log('fol: '+ fol);
			
			if (ftype == 0) { 
			
				$.ajax({
					type : 'get',
					url : "/planiter/follow.do?followerId=" +followerID +"&followingId="+followingID,
					contentType : "application/json; charset=UTF-8",
					dataType : "json",
					success : function(data) {
						console.log("followBTN Ftype= "+ftype+" data= " + data );
						 if(fol==1){
							 followerList();
						 }else if(fol==2){
							 followingList();
						 }
						
					},
					error : function(jqXHR, textStatus, errorThrown) {
						console.log(jqXHR.responseText);
					}
				});
				 
				 
			} else {//언팔로우
				  
				$.ajax({
					type : 'get',
					url : "/planiter/unfollow.do?followerId=" +followerID +"&followingId="+followingID,
					contentType : "application/json; charset=UTF-8",
					dataType : "json",
					success : function(data) {
						console.log("followBTN Ftype= "+ftype+" data= " + data );
						if(fol==1){
							 followerList();
						 }else if(fol==2){
							 followingList();
						 }
						

					},
					error : function(jqXHR, textStatus, errorThrown) {
						 
						console.log("followBTN error" );
						console.log(jqXHR.responseText);
					}
				});
				
				 
			}
			 
		}
	</script>




 
 
</th:block>
</html>